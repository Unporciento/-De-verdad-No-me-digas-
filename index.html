<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Instagram ZIP Analyzer</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<style>
body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    background: #0b0b0b;
    color: #fff;
}
header {
    padding: 15px;
    text-align: center;
    font-weight: 700;
    background: #111;
}
input {
    width: 100%;
    padding: 16px;
    background: #1a1a1a;
    border: none;
    color: #fff;
    font-size: 16px;
}
section {
    padding: 15px;
}
.card {
    background: #1b1b1b;
    border-radius: 14px;
    padding: 15px;
    margin-bottom: 12px;
}
.row {
    display: flex;
    justify-content: space-between;
}
</style>
</head>

<body>

<header>üì¶ Instagram ZIP Analyzer</header>

<input type="file" id="zipInput" accept=".zip">

<section id="output"></section>

<script>
const output = document.getElementById("output");

document.getElementById("zipInput").addEventListener("change", async e => {
    const file = e.target.files[0];
    if (!file) return;

    output.innerHTML = "<div class='card'>‚è≥ Analizando ZIP completo...</div>";

    const zip = await JSZip.loadAsync(file);

    let followers = new Set();
    let following = new Set();
    let chats = {};

    const files = Object.keys(zip.files);

    for (const path of files) {
        if (!path.endsWith(".json")) continue;

        try {
            const text = await zip.files[path].async("string");
            const data = JSON.parse(text);

            if (data.relationships_followers) {
                data.relationships_followers.forEach(u =>
                    followers.add(u.string_list_data[0].value)
                );
            }

            if (data.relationships_following) {
                data.relationships_following.forEach(u =>
                    following.add(u.string_list_data[0].value)
                );
            }

            if (data.messages) {
                data.messages.forEach(m => {
                    chats[m.sender_name] = (chats[m.sender_name] || 0) + 1;
                });
            }
        } catch {}
    }

    const notFollowingBack = [...following].filter(x => !followers.has(x));
    const topChat = Object.entries(chats).sort((a,b)=>b[1]-a[1])[0];

    output.innerHTML = `
        <div class="card">
            <h3>üìä Resumen</h3>
            <div class="row"><span>Seguidores</span><span>${followers.size}</span></div>
            <div class="row"><span>Siguiendo</span><span>${following.size}</span></div>
            <div class="row"><span>No te siguen</span><span>${notFollowingBack.length}</span></div>
            <div class="row"><span>Top contacto</span><span>${topChat ? topChat[0] : "‚Äî"}</span></div>
        </div>

        <div class="card">
            <h3>‚ùå No te siguen</h3>
            ${notFollowingBack.slice(0,100).map(n => `<div>${n}</div>`).join("")}
        </div>
    `;
});
</script>

</body>
</html>
